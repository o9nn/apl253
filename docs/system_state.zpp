â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 Z++ FORMAL SPECIFICATION: PATTERN LANGUAGE SYSTEM STATE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

This specification defines the complete system state for the Pattern Language
System, including pattern collections, schema registries, and transformation
contexts.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 1: PATTERN COLLECTION STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ PatternRegistry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Central registry maintaining all APL patterns indexed by pattern number    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  PatternRegistry
    patterns: PatternNumber â‡¶ Pattern
    meta_pattern: Pattern
    loaded_patterns: â„™ PatternNumber
  where
    /* Meta-pattern is always present and has number 0 */
    meta_pattern.number = 0 âˆ§
    0 âˆ‰ dom patterns
    
    /* All patterns in registry have matching pattern numbers */
    âˆ€ pn: PatternNumber | pn âˆˆ dom patterns â‡’ 
      patterns(pn).number = pn
    
    /* Loaded patterns must be subset of available patterns */
    loaded_patterns âŠ† dom patterns
    
    /* Pattern numbers must be in valid range */
    dom patterns âŠ† {1..253}
    
    /* All patterns are well-formed */
    âˆ€ pn âˆˆ dom patterns â€¢ ValidPattern(patterns(pn))


â”Œâ”€ CategoryRegistry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Registry organizing patterns into their respective categories              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  CategoryRegistry
    categories: CategoryName â‡¶ PatternCategory
    category_index: PatternNumber â‡¶ CategoryName
  where
    /* All three categories must be registered */
    dom categories = {Towns, Buildings, Construction}
    
    /* Category index must cover all patterns */
    dom category_index = {1..253}
    
    /* Category index must be consistent with category definitions */
    âˆ€ pn âˆˆ dom category_index â€¢ 
      let cat = category_index(pn) in
      let pc = categories(cat) in
      pn â‰¥ pc.pattern_range_start âˆ§ pn â‰¤ pc.pattern_range_end
    
    /* No overlap between categories */
    âˆ€ câ‚, câ‚‚: CategoryName | câ‚ â‰  câ‚‚ â‡’
      let pcâ‚ = categories(câ‚), pcâ‚‚ = categories(câ‚‚) in
      (pcâ‚.pattern_range_end < pcâ‚‚.pattern_range_start) âˆ¨
      (pcâ‚‚.pattern_range_end < pcâ‚.pattern_range_start)


â”Œâ”€ SequenceRegistry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Registry managing all 36 pattern sequences                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  SequenceRegistry
    sequences: 1..36 â‡¶ PatternSequence
    pattern_to_sequences: PatternNumber â‡¶ â„™(1..36)
  where
    /* All 36 sequences must be registered */
    dom sequences = {1..36}
    
    /* Sequences must have matching IDs */
    âˆ€ sid âˆˆ dom sequences â€¢ sequences(sid).id = sid
    
    /* Pattern to sequences mapping must be consistent */
    âˆ€ pn âˆˆ dom pattern_to_sequences â€¢ 
      pattern_to_sequences(pn) = 
        {sid | sid âˆˆ dom sequences âˆ§ pn âˆˆ sequences(sid).patterns}
    
    /* Each pattern appears in at least one sequence */
    âˆ€ pn: PatternNumber | pn âˆˆ {1..253} â‡’ 
      pn âˆˆ dom pattern_to_sequences âˆ§ 
      pattern_to_sequences(pn) â‰  âˆ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 2: ARCHETYPAL PATTERN STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ ArchetypalRegistry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Registry for all archetypal patterns with their domain mappings and        â”‚
â”‚ hierarchical relationships. Contains all 253 patterns from the UIA system. â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ArchetypalRegistry
    patterns: String â‡¶ ArchetypalPattern
    placeholder_registry: PlaceholderName â‡¶ PlaceholderDefinition
    loaded_archetypes: â„™ String
    relationship_graph: String â‡¶ (â„™ String Ã— â„™ String)
  where
    /* All patterns indexed by their pattern_id */
    âˆ€ pid âˆˆ dom patterns â€¢ patterns(pid).pattern_id = pid
    
    /* All pattern IDs are valid UIA identifiers */
    âˆ€ pid âˆˆ dom patterns â€¢ #pid â‰¥ 8
    
    /* Total of 253 archetypal patterns */
    #(dom patterns) = 253
    
    /* All patterns are well-formed */
    âˆ€ pid âˆˆ dom patterns â€¢ ValidArchetypalPattern(patterns(pid))
    
    /* Placeholder registry contains all placeholders used */
    dom placeholder_registry = 
      â‹ƒ{ap.placeholders | ap âˆˆ ran patterns}
    
    /* All placeholder definitions have complete domain mappings */
    âˆ€ ph âˆˆ dom placeholder_registry â€¢ 
      CompleteDomainMapping(placeholder_registry(ph).domains)
    
    /* Loaded archetypes must be subset of available patterns */
    loaded_archetypes âŠ† dom patterns
    
    /* Relationship graph must be consistent with pattern relationships */
    âˆ€ pid âˆˆ dom patterns â€¢
      let p = patterns(pid) in
      relationship_graph(pid) = 
        ({bp | bp âˆˆ p.broader_patterns}, 
         {np | np âˆˆ p.narrower_patterns})
    
    /* All relationships must be bidirectional */
    âˆ€ pid âˆˆ dom patterns â€¢
      let p = patterns(pid) in
      (âˆ€ bp âˆˆ p.broader_patterns â€¢ 
        bp âˆˆ dom patterns â‡’ 
          pid âˆˆ patterns(bp).narrower_patterns) âˆ§
      (âˆ€ np âˆˆ p.narrower_patterns â€¢
        np âˆˆ dom patterns â‡’
          pid âˆˆ patterns(np).broader_patterns)
    
    /* First pattern (12610010) has no broader patterns */
    "12610010" âˆˆ dom patterns â‡’
      patterns("12610010").broader_patterns = âŸ¨âŸ©
    
    /* Relationship graph is acyclic (no pattern can be ancestor of itself) */
    âˆ€ pid âˆˆ dom patterns â€¢ Â¬IsAncestorOf(pid, pid, relationship_graph)


â”Œâ”€ DomainMappingCache â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Cache for pre-computed domain mappings to optimize transformations         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  DomainMappingCache
    cache: (PlaceholderName Ã— Domain) â‡¶ String
    hit_count: (PlaceholderName Ã— Domain) â‡¶ â„•
    last_updated: (PlaceholderName Ã— Domain) â‡¶ â„•
  where
    /* All cache entries have hit counts */
    dom cache = dom hit_count
    
    /* All cache entries have timestamps */
    dom cache = dom last_updated
    
    /* Hit counts are non-negative */
    âˆ€ key âˆˆ dom hit_count â€¢ hit_count(key) â‰¥ 0
    
    /* Cached values must be non-empty */
    âˆ€ key âˆˆ dom cache â€¢ cache(key) â‰  ""

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 3: SCHEMA AND VALIDATION STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ SchemaRegistry â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Registry managing JSON schema definitions and validation results           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  SchemaRegistry
    pattern_schema: Schema
    archetypal_schema: Schema
    schema_versions: String â‡¶ String
    validation_cache: String â‡¶ ğ”¹
  where
    /* Schema versions track compatibility */
    "pattern_schema" âˆˆ dom schema_versions âˆ§
    "archetypal_schema" âˆˆ dom schema_versions
    
    /* All schema versions use JSON Schema Draft-07 */
    âˆ€ sv âˆˆ ran schema_versions â€¢ 
      sv = "http://json-schema.org/draft-07/schema#"
    
    /* Validation cache stores validation results */
    /* Key format: "schemaType:objectId" */


â”Œâ”€ ValidationState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Current state of schema validation processes                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ValidationState
    patterns_validated: â„™ PatternNumber
    archetypes_validated: â„™ String
    validation_errors: (String Ã— String) â‡¶ seq String
    last_validation_time: â„•
  where
    /* Validation errors indexed by type and ID */
    âˆ€ (vtype, vid) âˆˆ dom validation_errors â€¢ 
      vtype âˆˆ {"pattern", "archetypal", "sequence", "category"}
    
    /* Validated patterns must exist in registry */
    /* (requires access to PatternRegistry - see system invariants) */

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 4: FILE SYSTEM STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ FileSystemState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State of markdown source files and generated JSON outputs                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  FileSystemState
    markdown_files: String â‡¶ (String Ã— â„•)  /* path â†’ (content, timestamp) */
    json_files: String â‡¶ (String Ã— â„•)       /* path â†’ (content, timestamp) */
    file_dependencies: String â‡¶ â„™ String    /* output â†’ input sources */
  where
    /* Markdown files must be in markdown directory */
    âˆ€ path âˆˆ dom markdown_files â€¢ 
      path contains "markdown/" âˆ§ path ends_with ".md"
    
    /* JSON files must have .json extension */
    âˆ€ path âˆˆ dom json_files â€¢ 
      path ends_with ".json"
    
    /* File dependencies track which sources generate which outputs */
    dom file_dependencies âŠ† dom json_files
    
    /* Source files in dependencies must exist */
    âˆ€ output âˆˆ dom file_dependencies â€¢ 
      âˆ€ input âˆˆ file_dependencies(output) â€¢ 
        input âˆˆ dom markdown_files

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 5: TRANSFORMATION STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ TransformationContext â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Context for domain transformation operations                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  TransformationContext
    current_pattern: String  /* Pattern ID being transformed */
    target_domain: Domain
    placeholder_substitutions: PlaceholderName â‡¶ String
    transformation_history: seq (String Ã— Domain Ã— â„•)
  where
    /* Current pattern must be valid if set */
    current_pattern â‰  "" â‡’ #current_pattern â‰¥ 8
    
    /* All substitutions must be non-empty */
    âˆ€ ph âˆˆ dom placeholder_substitutions â€¢ 
      placeholder_substitutions(ph) â‰  ""
    
    /* Transformation history: (pattern_id, domain, timestamp) */

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 6: COMPLETE SYSTEM STATE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ PatternLanguageSystem â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Complete system state integrating all subsystems                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  PatternLanguageSystem
    pattern_registry: PatternRegistry
    category_registry: CategoryRegistry
    sequence_registry: SequenceRegistry
    archetypal_registry: ArchetypalRegistry
    domain_cache: DomainMappingCache
    schema_registry: SchemaRegistry
    validation_state: ValidationState
    filesystem_state: FileSystemState
    transformation_context: TransformationContext
  where
    /* CROSS-REGISTRY CONSISTENCY INVARIANTS */
    
    /* All patterns in category registry exist in pattern registry */
    âˆ€ pn âˆˆ dom category_registry.category_index â€¢ 
      pn âˆˆ dom pattern_registry.patterns
    
    /* All patterns in sequences exist in pattern registry */
    âˆ€ sid âˆˆ dom sequence_registry.sequences â€¢ 
      âˆ€ pn âˆˆ sequence_registry.sequences(sid).patterns â€¢ 
        pn âˆˆ dom pattern_registry.patterns
    
    /* Validated patterns must exist */
    validation_state.patterns_validated âŠ† 
      dom pattern_registry.patterns
    
    validation_state.archetypes_validated âŠ† 
      dom archetypal_registry.patterns
    
    /* Domain cache placeholders must exist in placeholder registry */
    âˆ€ (ph, d) âˆˆ dom domain_cache.cache â€¢ 
      ph âˆˆ dom archetypal_registry.placeholder_registry
    
    /* Current transformation pattern must exist if active */
    transformation_context.current_pattern â‰  "" â‡’
      transformation_context.current_pattern âˆˆ 
        dom archetypal_registry.patterns
    
    /* SYSTEM COMPLETENESS INVARIANTS */
    
    /* Pattern registry must be complete (253 patterns + meta) */
    #(dom pattern_registry.patterns) = 253
    
    /* All categories must be populated */
    #(dom category_registry.categories) = 3
    
    /* All sequences must be registered */
    #(dom sequence_registry.sequences) = 36
    
    /* Archetypal registry must have 102 patterns */
    #(dom archetypal_registry.patterns) = 102
    
    /* SCHEMA VALIDATION INVARIANTS */
    
    /* Schemas must be loaded */
    schema_registry.pattern_schema â‰  âˆ… âˆ§
    schema_registry.archetypal_schema â‰  âˆ…


â”Œâ”€ InitialState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Initial state of the system before any patterns are loaded                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  InitialState
    PatternLanguageSystem
  where
    /* No patterns loaded initially */
    pattern_registry.patterns = âˆ…
    pattern_registry.loaded_patterns = âˆ…
    
    /* No archetypal patterns loaded */
    archetypal_registry.patterns = âˆ…
    archetypal_registry.loaded_archetypes = âˆ…
    
    /* No validations performed */
    validation_state.patterns_validated = âˆ…
    validation_state.archetypes_validated = âˆ…
    
    /* No transformation in progress */
    transformation_context.current_pattern = ""
    
    /* Cache is empty */
    domain_cache.cache = âˆ…


â”Œâ”€ FullyLoadedState â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ State after all patterns and schemas have been successfully loaded         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  FullyLoadedState
    PatternLanguageSystem
  where
    /* All patterns loaded */
    pattern_registry.loaded_patterns = dom pattern_registry.patterns
    
    /* All categories populated */
    dom category_registry.categories = {Towns, Buildings, Construction}
    
    /* All sequences registered */
    dom sequence_registry.sequences = {1..36}
    
    /* All archetypal patterns loaded */
    archetypal_registry.loaded_archetypes = 
      dom archetypal_registry.patterns
    
    /* All patterns validated */
    validation_state.patterns_validated = 
      dom pattern_registry.patterns
    
    validation_state.archetypes_validated = 
      dom archetypal_registry.patterns

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 END OF SYSTEM STATE SPECIFICATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
