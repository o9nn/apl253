â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 Z++ FORMAL SPECIFICATION: PATTERN LANGUAGE OPERATIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

This specification defines all operations on the Pattern Language System,
including pattern generation, domain transformation, validation, and queries.

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 1: PATTERN LOADING OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ LoadPattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load a single pattern from markdown source into the registry               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  LoadPattern
    Î”PatternLanguageSystem
    pattern_number?: PatternNumber
    markdown_content?: String
    pattern!: Pattern
    success!: ğ”¹
  where
    /* Input must be valid pattern number */
    pattern_number? â‰¥ 1 âˆ§ pattern_number? â‰¤ 253
    
    /* Parse pattern from markdown content */
    pattern! = ParseMarkdownPattern(markdown_content?)
    
    /* Pattern number must match */
    pattern!.number = pattern_number?
    
    /* Success if pattern is valid */
    success! âŸº ValidPattern(pattern!)
    
    /* STATE CHANGES */
    success! â‡’
      /* Add pattern to registry */
      pattern_registry'.patterns = 
        pattern_registry.patterns âŠ• {pattern_number? â†¦ pattern!} âˆ§
      
      /* Mark as loaded */
      pattern_registry'.loaded_patterns = 
        pattern_registry.loaded_patterns âˆª {pattern_number?} âˆ§
      
      /* Other state unchanged */
      pattern_registry'.meta_pattern = pattern_registry.meta_pattern
    
    Â¬success! â‡’
      /* State unchanged on failure */
      pattern_registry' = pattern_registry


â”Œâ”€ LoadMetaPattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load the meta-pattern (Pattern Language itself as a pattern)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  LoadMetaPattern
    Î”PatternLanguageSystem
    markdown_content?: String
    meta_pattern!: Pattern
    success!: ğ”¹
  where
    /* Parse meta-pattern from markdown */
    meta_pattern! = ParseMetaPattern(markdown_content?)
    
    /* Meta-pattern must have number 0 */
    meta_pattern!.number = 0
    
    /* Meta-pattern must have maximum evidence level */
    meta_pattern!.asterisks = 2
    
    /* Success if valid */
    success! âŸº ValidPattern(meta_pattern!)
    
    /* STATE CHANGES */
    success! â‡’
      pattern_registry'.meta_pattern = meta_pattern! âˆ§
      pattern_registry'.patterns = pattern_registry.patterns âˆ§
      pattern_registry'.loaded_patterns = pattern_registry.loaded_patterns
    
    Â¬success! â‡’
      pattern_registry' = pattern_registry


â”Œâ”€ LoadArchetypalPattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load an archetypal pattern with domain mappings                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  LoadArchetypalPattern
    Î”PatternLanguageSystem
    pattern_id?: String
    markdown_content?: String
    archetypal_pattern!: ArchetypalPattern
    success!: ğ”¹
  where
    /* Pattern ID must be valid UIA identifier */
    #pattern_id? â‰¥ 8
    
    /* Parse archetypal pattern from markdown */
    archetypal_pattern! = ParseArchetypalMarkdown(markdown_content?)
    
    /* Pattern ID must match */
    archetypal_pattern!.pattern_id = pattern_id?
    
    /* Success if valid */
    success! âŸº ValidArchetypalPattern(archetypal_pattern!)
    
    /* STATE CHANGES */
    success! â‡’
      /* Add to registry */
      archetypal_registry'.patterns = 
        archetypal_registry.patterns âŠ• 
        {pattern_id? â†¦ archetypal_pattern!} âˆ§
      
      /* Mark as loaded */
      archetypal_registry'.loaded_archetypes = 
        archetypal_registry.loaded_archetypes âˆª {pattern_id?} âˆ§
      
      /* Update placeholder registry with new placeholders */
      archetypal_registry'.placeholder_registry = 
        archetypal_registry.placeholder_registry âŠ•
        ExtractPlaceholderDefinitions(archetypal_pattern!)
    
    Â¬success! â‡’
      archetypal_registry' = archetypal_registry

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 2: PATTERN QUERY OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ GetPattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve a pattern by its number (read-only)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GetPattern
    ÎPatternLanguageSystem
    pattern_number?: PatternNumber
    pattern!: Pattern
    found!: ğ”¹
  where
    /* Check if pattern exists */
    found! âŸº pattern_number? âˆˆ dom pattern_registry.patterns
    
    /* Return pattern if found */
    found! â‡’ pattern! = pattern_registry.patterns(pattern_number?)
    
    /* No state changes */


â”Œâ”€ GetPatternByName â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve a pattern by name (read-only)                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GetPatternByName
    ÎPatternLanguageSystem
    name?: String
    pattern!: Pattern
    found!: ğ”¹
  where
    /* Search for pattern with matching name */
    found! âŸº âˆƒ pn âˆˆ dom pattern_registry.patterns â€¢ 
      pattern_registry.patterns(pn).name = name?
    
    /* Return first matching pattern */
    found! â‡’ 
      pattern! âˆˆ ran pattern_registry.patterns âˆ§
      pattern!.name = name?


â”Œâ”€ GetPatternsInSequence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve all patterns in a specific sequence (read-only)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GetPatternsInSequence
    ÎPatternLanguageSystem
    sequence_id?: 1..36
    patterns!: seq Pattern
    sequence!: PatternSequence
  where
    /* Sequence must exist */
    sequence_id? âˆˆ dom sequence_registry.sequences
    
    /* Get sequence definition */
    sequence! = sequence_registry.sequences(sequence_id?)
    
    /* Retrieve all patterns in sequence */
    patterns! = âŸ¨pattern_registry.patterns(pn) | 
                 pn âˆˆ sequence!.patternsâŸ©
    
    /* Patterns in output maintain sequence order */
    âˆ€ i, j: â„• | i < j âˆ§ j < #patterns! â‡’ 
      patterns![i].number â‰¤ patterns![j].number


â”Œâ”€ GetPatternsInCategory â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve all patterns in a category (read-only)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GetPatternsInCategory
    ÎPatternLanguageSystem
    category?: CategoryName
    patterns!: seq Pattern
    count!: â„•
  where
    /* Category must exist */
    category? âˆˆ dom category_registry.categories
    
    /* Get category definition */
    let cat = category_registry.categories(category?) in
    
    /* Retrieve all patterns in range */
    patterns! = âŸ¨pattern_registry.patterns(pn) | 
                 pn âˆˆ {cat.pattern_range_start .. cat.pattern_range_end}âŸ©
    
    /* Return count */
    count! = #patterns!

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 3: DOMAIN TRANSFORMATION OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ TransformToPhysical â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Transform an archetypal pattern to Physical domain                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  TransformToPhysical
    ÎArchetypalRegistry
    Î”TransformationContext
    pattern_id?: String
    transformed!: TransformedPattern
    success!: ğ”¹
  where
    /* Pattern must exist */
    pattern_id? âˆˆ dom archetypal_registry.patterns
    
    let ap = archetypal_registry.patterns(pattern_id?) in
    
    /* Set transformation context */
    transformation_context'.current_pattern = pattern_id? âˆ§
    transformation_context'.target_domain = Physical
    
    /* Build substitutions from domain mappings */
    transformation_context'.placeholder_substitutions = 
      {ph â†¦ archetypal_registry.placeholder_registry(ph).domains.physical |
       ph âˆˆ ap.placeholders}
    
    /* Apply transformations */
    let text = ap.archetypal_pattern in
    let result = ApplySubstitutions(text, 
                   transformation_context'.placeholder_substitutions) in
    
    /* Build result */
    transformed!.source_pattern_id = pattern_id? âˆ§
    transformed!.target_domain = Physical âˆ§
    transformed!.transformed_text = result âˆ§
    transformed!.substitutions = 
      transformation_context'.placeholder_substitutions
    
    /* Success if no unreplaced placeholders remain */
    success! âŸº Â¬(result contains "{{")
    
    /* Record in history */
    transformation_context'.transformation_history = 
      transformation_context.transformation_history âŒ¢ 
      âŸ¨(pattern_id?, Physical, CurrentTimestamp())âŸ©


â”Œâ”€ TransformToDomain â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generic transformation to any domain                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  TransformToDomain
    ÎArchetypalRegistry
    Î”TransformationContext
    Î”DomainMappingCache
    pattern_id?: String
    target_domain?: Domain
    transformed!: TransformedPattern
    success!: ğ”¹
  where
    /* Pattern must exist */
    pattern_id? âˆˆ dom archetypal_registry.patterns
    
    let ap = archetypal_registry.patterns(pattern_id?) in
    
    /* Set transformation context */
    transformation_context'.current_pattern = pattern_id? âˆ§
    transformation_context'.target_domain = target_domain?
    
    /* Build substitutions based on target domain */
    transformation_context'.placeholder_substitutions = 
      {ph â†¦ GetDomainMapping(ph, target_domain?, domain_cache) |
       ph âˆˆ ap.placeholders}
    
    /* Apply transformations */
    let result = ApplySubstitutions(
                   ap.archetypal_pattern,
                   transformation_context'.placeholder_substitutions) in
    
    /* Build result */
    transformed!.source_pattern_id = pattern_id? âˆ§
    transformed!.target_domain = target_domain? âˆ§
    transformed!.transformed_text = result âˆ§
    transformed!.substitutions = 
      transformation_context'.placeholder_substitutions
    
    /* Success if complete transformation */
    success! âŸº Â¬(result contains "{{")
    
    /* Update cache hit counts */
    âˆ€ ph âˆˆ ap.placeholders â€¢
      let key = (ph, target_domain?) in
      domain_cache'.hit_count = domain_cache.hit_count âŠ•
        {key â†¦ (domain_cache.hit_count(key) + 1)}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 4: SCHEMA GENERATION OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ GeneratePatternSchema â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate JSON schema for the pattern language                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GeneratePatternSchema
    ÎPatternRegistry
    ÎCategoryRegistry
    ÎSequenceRegistry
    Î”SchemaRegistry
    output!: String
    success!: ğ”¹
  where
    /* Construct complete pattern language structure */
    let pl = PatternLanguage where
      pl.meta_pattern = pattern_registry.meta_pattern âˆ§
      pl.categories = âŸ¨category_registry.categories(c) | 
                       c âˆˆ {Towns, Buildings, Construction}âŸ© âˆ§
      pl.sequences = âŸ¨sequence_registry.sequences(sid) | 
                      sid âˆˆ {1..36}âŸ©
    
    /* Serialize to JSON */
    output! = SerializeToJSON(pl, schema_registry.pattern_schema)
    
    /* Success if serialization valid */
    success! âŸº ValidJSON(output!) âˆ§
               ValidatesAgainstSchema(output!, schema_registry.pattern_schema)
    
    /* Update schema registry */
    schema_registry'.validation_cache = 
      schema_registry.validation_cache âŠ•
      {"pattern_language:complete" â†¦ success!}


â”Œâ”€ GenerateArchetypalSchema â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate JSON schema for archetypal patterns                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GenerateArchetypalSchema
    ÎArchetypalRegistry
    Î”SchemaRegistry
    output!: String
    success!: ğ”¹
  where
    /* Construct archetypal pattern collection */
    let apc = ArchetypalPatternCollection where
      apc.title = "UIA Archetypal Patterns" âˆ§
      apc.total_patterns = #(dom archetypal_registry.patterns) âˆ§
      apc.patterns = âŸ¨archetypal_registry.patterns(pid) | 
                      pid âˆˆ dom archetypal_registry.patternsâŸ© âˆ§
      apc.placeholder_definitions = 
        âŸ¨archetypal_registry.placeholder_registry(ph) |
         ph âˆˆ dom archetypal_registry.placeholder_registryâŸ©
    
    /* Serialize to JSON */
    output! = SerializeToJSON(apc, schema_registry.archetypal_schema)
    
    /* Validate */
    success! âŸº ValidJSON(output!) âˆ§
               ValidatesAgainstSchema(output!, 
                                     schema_registry.archetypal_schema)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 5: VALIDATION OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ ValidatePattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate a pattern against structural and semantic rules                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ValidatePattern
    ÎPatternRegistry
    Î”ValidationState
    pattern_number?: PatternNumber
    errors!: seq String
    valid!: ğ”¹
  where
    /* Pattern must exist */
    pattern_number? âˆˆ dom pattern_registry.patterns
    
    let p = pattern_registry.patterns(pattern_number?) in
    
    /* Collect validation errors */
    errors! = âŸ¨âŸ©
    
    /* Check required fields */
    p.name = "" â‡’ errors! = errors! âŒ¢ âŸ¨"Pattern name is empty"âŸ©
    p.problem_summary = "" â‡’ 
      errors! = errors! âŒ¢ âŸ¨"Problem summary is empty"âŸ©
    p.solution = "" â‡’ errors! = errors! âŒ¢ âŸ¨"Solution is empty"âŸ©
    
    /* Check pattern number */
    p.number â‰  pattern_number? â‡’ 
      errors! = errors! âŒ¢ âŸ¨"Pattern number mismatch"âŸ©
    
    /* Check asterisk level */
    p.asterisks âˆ‰ {0, 1, 2} â‡’ 
      errors! = errors! âŒ¢ âŸ¨"Invalid asterisk level"âŸ©
    
    /* Check pattern references */
    âˆ€ preceding âˆˆ p.preceding_patterns â€¢
      preceding â‰¥ p.number â‡’ 
        errors! = errors! âŒ¢ âŸ¨"Preceding pattern has higher number"âŸ©
    
    âˆ€ following âˆˆ p.following_patterns â€¢
      following â‰¤ p.number â‡’ 
        errors! = errors! âŒ¢ âŸ¨"Following pattern has lower number"âŸ©
    
    /* Valid if no errors */
    valid! âŸº errors! = âŸ¨âŸ©
    
    /* Update validation state */
    valid! â‡’
      validation_state'.patterns_validated = 
        validation_state.patterns_validated âˆª {pattern_number?}
    
    Â¬valid! â‡’
      validation_state'.validation_errors = 
        validation_state.validation_errors âŠ•
        {("pattern", pattern_number?) â†¦ errors!}


â”Œâ”€ ValidateArchetypalPattern â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate an archetypal pattern                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ValidateArchetypalPattern
    ÎArchetypalRegistry
    Î”ValidationState
    pattern_id?: String
    errors!: seq String
    valid!: ğ”¹
  where
    /* Pattern must exist */
    pattern_id? âˆˆ dom archetypal_registry.patterns
    
    let ap = archetypal_registry.patterns(pattern_id?) in
    
    /* Collect validation errors */
    errors! = âŸ¨âŸ©
    
    /* Check required fields */
    ap.name = "" â‡’ errors! = errors! âŒ¢ âŸ¨"Pattern name is empty"âŸ©
    ap.archetypal_pattern = "" â‡’ 
      errors! = errors! âŒ¢ âŸ¨"Archetypal pattern is empty"âŸ©
    
    /* Check placeholders */
    ap.placeholders = âŸ¨âŸ© â‡’ 
      errors! = errors! âŒ¢ âŸ¨"No placeholders defined"âŸ©
    
    /* Check all placeholders have domain mappings */
    âˆ€ ph âˆˆ ap.placeholders â€¢
      ph âˆ‰ dom ap.domain_mappings â‡’ 
        errors! = errors! âŒ¢ 
          âŸ¨"Placeholder " âŒ¢ ph âŒ¢ " missing domain mapping"âŸ©
    
    /* Check placeholder syntax in pattern text */
    âˆ€ ph âˆˆ ap.placeholders â€¢
      Â¬(ap.archetypal_pattern contains ("{{" âŒ¢ ph âŒ¢ "}}")) â‡’ 
        errors! = errors! âŒ¢ 
          âŸ¨"Placeholder " âŒ¢ ph âŒ¢ " not found in pattern text"âŸ©
    
    /* Check domain completeness */
    âˆ€ ph âˆˆ dom ap.domain_mappings â€¢
      Â¬CompleteDomainMapping(ap.domain_mappings(ph)) â‡’ 
        errors! = errors! âŒ¢ 
          âŸ¨"Incomplete domain mapping for " âŒ¢ phâŸ©
    
    /* Valid if no errors */
    valid! âŸº errors! = âŸ¨âŸ©
    
    /* Update validation state */
    valid! â‡’
      validation_state'.archetypes_validated = 
        validation_state.archetypes_validated âˆª {pattern_id?}

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 6: BATCH OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ LoadAllPatterns â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load all APL patterns from markdown directory                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  LoadAllPatterns
    Î”PatternLanguageSystem
    markdown_dir?: String
    loaded_count!: â„•
    success!: ğ”¹
  where
    /* Load meta-pattern first */
    âˆƒ meta_content: String â€¢ 
      LoadMetaPattern[meta_content?/markdown_content?]
    
    /* Load all 253 patterns */
    âˆ€ pn: PatternNumber | pn âˆˆ {1..253} â€¢
      âˆƒ content: String â€¢ 
        LoadPattern[pn/pattern_number?, content/markdown_content?]
    
    /* Count successfully loaded patterns */
    loaded_count! = #pattern_registry'.loaded_patterns
    
    /* Success if all patterns loaded */
    success! âŸº loaded_count! = 253


â”Œâ”€ ValidateAllPatterns â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate all loaded patterns                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ValidateAllPatterns
    ÎPatternRegistry
    Î”ValidationState
    total_errors!: â„•
    all_valid!: ğ”¹
  where
    /* Validate each loaded pattern */
    âˆ€ pn âˆˆ pattern_registry.loaded_patterns â€¢
      ValidatePattern[pn/pattern_number?]
    
    /* Count total errors */
    total_errors! = #(dom validation_state'.validation_errors)
    
    /* All valid if no errors */
    all_valid! âŸº total_errors! = 0


â”Œâ”€ TransformAllToAllDomains â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Transform all archetypal patterns to all four domains                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  TransformAllToAllDomains
    ÎArchetypalRegistry
    Î”TransformationContext
    Î”DomainMappingCache
    results!: seq TransformedPattern
    success_count!: â„•
  where
    /* Transform each pattern to each domain */
    results! = âŸ¨transformed | 
      pid âˆˆ dom archetypal_registry.patterns,
      d âˆˆ {Physical, Social, Conceptual, Psychic},
      TransformToDomain[pid/pattern_id?, d/target_domain?, 
                        transformed/transformed!]âŸ©
    
    /* Count successful transformations */
    success_count! = #{t | t âˆˆ results! âˆ§ 
                          Â¬(t.transformed_text contains "{{")}
    
    /* Should be 253 patterns Ã— 4 domains = 1012 transformations */
    #results! = 1012

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
 SECTION 6: PATTERN HIERARCHY NAVIGATION OPERATIONS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â”Œâ”€ GetBroaderPatterns â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve all broader (higher-level) patterns for a given pattern           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GetBroaderPatterns
    ÎArchetypalRegistry
    pattern_id?: String
    broader_patterns!: seq ArchetypalPattern
    found!: ğ”¹
  where
    /* Pattern must exist in registry */
    pattern_id? âˆˆ dom archetypal_registry.patterns
    
    /* Look up the pattern */
    found! âŸº pattern_id? âˆˆ dom archetypal_registry.patterns
    
    found! â‡’
      let source_pattern == archetypal_registry.patterns(pattern_id?) â€¢
        broader_patterns! = âŸ¨bp | 
          bp_id âˆˆ source_pattern.broader_patterns,
          bp_id âˆˆ dom archetypal_registry.patterns,
          bp = archetypal_registry.patterns(bp_id)âŸ©
    
    Â¬found! â‡’
      broader_patterns! = âŸ¨âŸ©


â”Œâ”€ GetNarrowerPatterns â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Retrieve all narrower (lower-level) patterns for a given pattern           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GetNarrowerPatterns
    ÎArchetypalRegistry
    pattern_id?: String
    narrower_patterns!: seq ArchetypalPattern
    found!: ğ”¹
  where
    /* Pattern must exist in registry */
    pattern_id? âˆˆ dom archetypal_registry.patterns
    
    /* Look up the pattern */
    found! âŸº pattern_id? âˆˆ dom archetypal_registry.patterns
    
    found! â‡’
      let source_pattern == archetypal_registry.patterns(pattern_id?) â€¢
        narrower_patterns! = âŸ¨np | 
          np_id âˆˆ source_pattern.narrower_patterns,
          np_id âˆˆ dom archetypal_registry.patterns,
          np = archetypal_registry.patterns(np_id)âŸ©
    
    Â¬found! â‡’
      narrower_patterns! = âŸ¨âŸ©


â”Œâ”€ TraversePatternHierarchy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Traverse the pattern hierarchy starting from a given pattern, visiting     â”‚
â”‚ all patterns reachable through broader or narrower relationships           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  TraversePatternHierarchy
    ÎArchetypalRegistry
    start_pattern_id?: String
    direction?: {broader, narrower, both}
    max_depth?: â„•
    visited_patterns!: seq ArchetypalPattern
    traversal_depth!: â„•
  where
    /* Starting pattern must exist */
    start_pattern_id? âˆˆ dom archetypal_registry.patterns
    
    /* Max depth must be reasonable */
    max_depth? > 0 âˆ§ max_depth? â‰¤ 253
    
    /* Traverse based on direction */
    direction? = broader â‡’
      visited_patterns! = BreadthFirstTraversal(
        start_pattern_id?, 
        Î» p â€¢ p.broader_patterns,
        max_depth?)
    
    direction? = narrower â‡’
      visited_patterns! = BreadthFirstTraversal(
        start_pattern_id?,
        Î» p â€¢ p.narrower_patterns,
        max_depth?)
    
    direction? = both â‡’
      visited_patterns! = BreadthFirstTraversal(
        start_pattern_id?,
        Î» p â€¢ p.broader_patterns âŠ• p.narrower_patterns,
        max_depth?)
    
    /* Calculate actual traversal depth */
    traversal_depth! = MaxDistanceFromStart(visited_patterns!)


â”Œâ”€ FindPatternPath â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Find the shortest path between two patterns in the hierarchy               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  FindPatternPath
    ÎArchetypalRegistry
    start_pattern_id?: String
    target_pattern_id?: String
    path!: seq String
    distance!: â„•
    found!: ğ”¹
  where
    /* Both patterns must exist */
    start_pattern_id? âˆˆ dom archetypal_registry.patterns âˆ§
    target_pattern_id? âˆˆ dom archetypal_registry.patterns
    
    /* Find shortest path using bidirectional search */
    found! âŸº 
      âˆƒ connecting_path: seq String â€¢
        connecting_path(0) = start_pattern_id? âˆ§
        connecting_path(#connecting_path - 1) = target_pattern_id? âˆ§
        âˆ€ i: 0..(#connecting_path - 2) â€¢
          let current == archetypal_registry.patterns(connecting_path(i)),
              next == connecting_path(i + 1) â€¢
            next âˆˆ current.broader_patterns âˆª current.narrower_patterns
    
    found! â‡’
      path! = ShortestPath(start_pattern_id?, target_pattern_id?) âˆ§
      distance! = #path! - 1
    
    Â¬found! â‡’
      path! = âŸ¨âŸ© âˆ§
      distance! = 0


â”Œâ”€ GetPatternLineage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Get the complete lineage from a pattern to the root pattern                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  GetPatternLineage
    ÎArchetypalRegistry
    pattern_id?: String
    lineage!: seq ArchetypalPattern
    depth!: â„•
  where
    /* Pattern must exist */
    pattern_id? âˆˆ dom archetypal_registry.patterns
    
    /* Recursively follow broader patterns to root */
    lineage! = âŸ¨p | 
      p = TraceToRoot(pattern_id?, archetypal_registry.patterns)âŸ©
    
    /* First element should be the root pattern (12610010) */
    #lineage! > 0 â‡’ lineage!(0).pattern_id = "12610010"
    
    /* Last element should be the starting pattern */
    #lineage! > 0 â‡’ 
      lineage!(#lineage! - 1).pattern_id = pattern_id?
    
    /* Depth is number of levels from root */
    depth! = #lineage! - 1


â”Œâ”€ ValidatePatternRelationships â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Validate that all pattern relationships are consistent and bidirectional   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  ValidatePatternRelationships
    ÎArchetypalRegistry
    inconsistencies!: seq String
    is_valid!: ğ”¹
  where
    /* Check bidirectional consistency */
    inconsistencies! = âŸ¨error_msg |
      pid âˆˆ dom archetypal_registry.patterns,
      let p == archetypal_registry.patterns(pid) â€¢
        (âˆƒ bp âˆˆ p.broader_patterns â€¢
          bp âˆˆ dom archetypal_registry.patterns âˆ§
          let broader == archetypal_registry.patterns(bp) â€¢
            pid âˆ‰ broader.narrower_patterns âˆ§
            error_msg = "Pattern " âŒ¢ pid âŒ¢ " has broader " âŒ¢ bp âŒ¢
                       " but is not in its narrower patterns") âˆ¨
        (âˆƒ np âˆˆ p.narrower_patterns â€¢
          np âˆˆ dom archetypal_registry.patterns âˆ§
          let narrower == archetypal_registry.patterns(np) â€¢
            pid âˆ‰ narrower.broader_patterns âˆ§
            error_msg = "Pattern " âŒ¢ pid âŒ¢ " has narrower " âŒ¢ np âŒ¢
                       " but is not in its broader patterns")âŸ©
    
    /* Valid if no inconsistencies found */
    is_valid! âŸº inconsistencies! = âŸ¨âŸ©

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
 END OF OPERATIONS SPECIFICATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
